<!-- HTML header for doxygen 1.9.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=11" />
    <meta name="generator" content="Doxygen 1.9.7" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TALCS: Tutorial: Combining Audio Clips and Mixing Multi-track Audio with TALCS</title>
    <link href="tabs.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
 <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
 <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" /> <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="extra-stylesheet.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
    <script type="text/javascript">
        DoxygenAwesomeDarkModeToggle.init()
    </script>
</head>
<body>
        <div id="top">
            <!-- do not remove this div, it is closed by doxygen! -->
            <div id="titlearea">
                <table cellspacing="0" cellpadding="0">
                    <tbody>
                        <tr id="projectrow">
                            <td id="projectalign">
                                <div id="projectname">TALCS
                                    <span id="projectnumber">&#160;0.0.1.1</span>
                                </div>
                                <div id="projectbrief">TALCS: Audio Library of CrSjimo</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- end header part --><!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__c_1_2_users_2_crs__1_2diffscope_2libs_2talcs_2doc_203__tutorial__combining__audio__clips__an3566f6b6c2fab87cbd8a50f5b869b2bf.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Tutorial: Combining Audio Clips and Mixing Multi-track Audio with TALCS</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md2"></a> TALCS can be used to combine several audio clips and mix multi-track audio.</p>
<p><a class="el" href="classtalcs_1_1_audio_source_clip_series.html">AudioSourceClipSeries</a> is a type of <a class="el" href="classtalcs_1_1_positionable_audio_source.html">PositionableAudioSource</a> that takes several AudioSourceClip (a. k. a <a class="el" href="structtalcs_1_1_audio_clip_base.html">AudioClipBase</a>&lt; <a class="el" href="classtalcs_1_1_positionable_audio_source.html">PositionableAudioSource</a> &gt;), each of which takes a <a class="el" href="classtalcs_1_1_positionable_audio_source.html">PositionableAudioSource</a>. These clips are sequentially combined together and produced by the <a class="el" href="classtalcs_1_1_audio_source_clip_series.html">AudioSourceClipSeries</a>.</p>
<p>Here is an example of how to use <a class="el" href="classtalcs_1_1_audio_source_clip_series.html">AudioSourceClipSeries</a>:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> audioSourceClipSeries = <span class="keyword">new</span> <a class="code hl_class" href="classtalcs_1_1_audio_source_clip_series.html">talcs::AudioSourceClipSeries</a>;</div>
<div class="line"><span class="keyword">auto</span> src1 = <span class="keyword">new</span> <a class="code hl_class" href="classtalcs_1_1_sine_wave_audio_source.html">talcs::SineWaveAudioSource</a>(440);</div>
<div class="line">audioSourceClipSeries-&gt;addClip({</div>
<div class="line">    .position = 0,</div>
<div class="line">    .content = src1,</div>
<div class="line">    .startPos = 0,</div>
<div class="line">    .length = 44100 * 2,</div>
<div class="line">});</div>
<div class="line"><span class="keyword">auto</span> src2 = <span class="keyword">new</span> <a class="code hl_class" href="classtalcs_1_1_sine_wave_audio_source.html">talcs::SineWaveAudioSource</a>(880);</div>
<div class="line">audioSourceClipSeries-&gt;addClip({</div>
<div class="line">    .position = 44100 * 4,</div>
<div class="line">    .content = src2,</div>
<div class="line">    .startPos = 0,</div>
<div class="line">    .length = 44100 * 2,</div>
<div class="line">});</div>
<div class="ttc" id="aclasstalcs_1_1_audio_source_clip_series_html"><div class="ttname"><a href="classtalcs_1_1_audio_source_clip_series.html">talcs::AudioSourceClipSeries</a></div><div class="ttdoc">An AudioClipsSeriesBase object that uses PositionableAudioSource.</div><div class="ttdef"><b>Definition</b> AudioSourceClipSeries.h:18</div></div>
<div class="ttc" id="aclasstalcs_1_1_sine_wave_audio_source_html"><div class="ttname"><a href="classtalcs_1_1_sine_wave_audio_source.html">talcs::SineWaveAudioSource</a></div><div class="ttdoc">Generates sine wave.</div><div class="ttdef"><b>Definition</b> SineWaveAudioSource.h:12</div></div>
</div><!-- fragment --><p>This example creates two audio clips. The first one is a 440 Hz sine wave and the second one is an 880 Hz sine wave. The start position of the first clip is 0 and the start position of the second clip is 44100 * 4. The length of each clip is 44100 * 2.</p>
<p>Please note that overlapping clips are not allowed to be added to the series. In this case, AudioSourceClipSeries::addClip() returns <code>false</code>.</p>
<p><a class="el" href="structtalcs_1_1_i_mixer.html">IMixer</a> is an interface that mixes several tracks together. There are 2 classes that implement it: <a class="el" href="classtalcs_1_1_mixer_audio_source.html">MixerAudioSource</a> (which takes <a class="el" href="classtalcs_1_1_audio_source.html">AudioSource</a>) and <a class="el" href="classtalcs_1_1_positionable_audio_source.html">PositionableMixerAudioSource</a> (which takes <a class="el" href="classtalcs_1_1_positionable_audio_source.html">PositionableAudioSource</a>).</p>
<p>Here is an example of how to use <a class="el" href="classtalcs_1_1_positionable_audio_source.html">PositionableMixerAudioSource</a>:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> mixer = <span class="keyword">new</span> <a class="code hl_class" href="classtalcs_1_1_positionable_mixer_audio_source.html">talcs::PositionableMixerAudioSource</a>;</div>
<div class="line"><span class="keyword">auto</span> src3 = <span class="keyword">new</span> <a class="code hl_class" href="classtalcs_1_1_sine_wave_audio_source.html">talcs::SineWaveAudioSource</a>(1320);</div>
<div class="line">mixer-&gt;addSource(audioSourceClipSeries);</div>
<div class="line">mixer-&gt;addSource(src3);</div>
<div class="line">mixer-&gt;setGain(0.5);</div>
<div class="line">mixer-&gt;setPan(0.5);</div>
<div class="ttc" id="aclasstalcs_1_1_positionable_mixer_audio_source_html"><div class="ttname"><a href="classtalcs_1_1_positionable_mixer_audio_source.html">talcs::PositionableMixerAudioSource</a></div><div class="ttdoc">A class very similar to MixerAudioSource, but this one supports repositioning.</div><div class="ttdef"><b>Definition</b> PositionableMixerAudioSource.h:14</div></div>
</div><!-- fragment --><p>The example creates a mixer and mixes the <a class="el" href="classtalcs_1_1_audio_source_clip_series.html">AudioSourceClipSeries</a> object created above and a 1320 Hz sine wave source together. Then the example sets the output gain to 0.5 (approx. -3 dB) and the output pan to 0.5.</p>
<p><a class="el" href="structtalcs_1_1_i_mixer.html">IMixer</a> can also be used to route the input sources to output channels. To use this feature, call <a class="el" href="structtalcs_1_1_i_mixer.html#a2b98d9b247c44e9701512a33f17cf510">IMixer::setRouteChannels()</a> and set it to <code>true</code> For example, if 4 channels are read from this object, and this object owns 3 input sources, the first and the second channels are read from the first input source, the third and the fourth channels are read from the second source, and the third source is not read. The order in which input sources are processed depends on the order in which they were added.</p>
<p>Now, let's dive deeper and have a look at a more complicated example. First, we define a schema of JSON that contains the synthesis information. <code>audio</code> property represents the index of audio file in <code>audioFiles</code>, and <code>pos</code>, <code>start</code>, <code>length</code> are all measured in seconds.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;audioFiles&quot;: [</div>
<div class="line">        &quot;path/to/the/first/audio/file.flac&quot;,</div>
<div class="line">        &quot;path/to/the/second/audio/file.mp3&quot;</div>
<div class="line">    ],</div>
<div class="line">    &quot;tracks&quot;: [</div>
<div class="line">        {</div>
<div class="line">            &quot;gain&quot;: 0.5,</div>
<div class="line">            &quot;pan&quot;: 0.5,</div>
<div class="line">            &quot;clips&quot;: [</div>
<div class="line">                {</div>
<div class="line">                    &quot;audio&quot;: 1,</div>
<div class="line">                    &quot;pos&quot;: 0,</div>
<div class="line">                    &quot;start&quot;: 1.14,</div>
<div class="line">                    &quot;length&quot;: 5.14</div>
<div class="line">                },</div>
<div class="line">                {</div>
<div class="line">                    &quot;audio&quot;: 0,</div>
<div class="line">                    &quot;pos&quot;: 19.19,</div>
<div class="line">                    &quot;start&quot;: 8.10,</div>
<div class="line">                    &quot;length&quot;: 19.26</div>
<div class="line">                },</div>
<div class="line">                {</div>
<div class="line">                    &quot;audio&quot;: 1,</div>
<div class="line">                    &quot;pos&quot;: 11.45,</div>
<div class="line">                    &quot;start&quot;: 14,</div>
<div class="line">                    &quot;length&quot;: 7</div>
<div class="line">                }</div>
<div class="line">            ]</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            &quot;gain&quot;: 0.5,</div>
<div class="line">            &quot;pan&quot;: 0.0,</div>
<div class="line">            &quot;clips&quot;: [</div>
<div class="line">                {</div>
<div class="line">                    &quot;audio&quot;: 0,</div>
<div class="line">                    &quot;pos&quot;: 0,</div>
<div class="line">                    &quot;start&quot;: 0,</div>
<div class="line">                    &quot;length&quot;: 100</div>
<div class="line">                }</div>
<div class="line">            ]</div>
<div class="line">        }</div>
<div class="line">    ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>Then, parse the JSON file and create the layout of clip series and tracks:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>talcs;</div>
<div class="line">QList&lt;QFile *&gt; srcFileList;</div>
<div class="line">QList&lt;AudioFormatIO *&gt; srcIoList;</div>
<div class="line">QList&lt;AudioFormatInputSource *&gt; srcList;</div>
<div class="line">QList&lt;PositionableMixerAudioSource *&gt; trackSrcList;</div>
<div class="line"><a class="code hl_class" href="classtalcs_1_1_positionable_mixer_audio_source.html">PositionableMixerAudioSource</a> mixer;</div>
<div class="line">qint64 effectiveLength = 0;</div>
<div class="line">QFile f(<span class="stringliteral">&quot;path/to/synth/file.json&quot;</span>);</div>
<div class="line">f.open(QFile::ReadOnly);</div>
<div class="line"><span class="keyword">auto</span> doc = QJsonDocument::fromJson(f.readAll());</div>
<div class="line"><span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span> &amp;audioFileNameJsonVal: doc.object().value(<span class="stringliteral">&quot;audioFiles&quot;</span>).toArray()) {</div>
<div class="line">    <span class="keyword">auto</span> audioFile = <span class="keyword">new</span> QFile(audioFileNameJsonVal.toString());</div>
<div class="line">    qDebug() &lt;&lt; audioFileNameJsonVal.toString();</div>
<div class="line">    srcFileList.append(audioFile);</div>
<div class="line">    srcIoList.append(<span class="keyword">new</span> <a class="code hl_class" href="classtalcs_1_1_audio_format_i_o.html">AudioFormatIO</a>(audioFile));</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span> &amp;trackSpec: doc.object().value(<span class="stringliteral">&quot;tracks&quot;</span>).toArray()) {</div>
<div class="line">    <span class="keyword">auto</span> clipSeries = <span class="keyword">new</span> <a class="code hl_class" href="classtalcs_1_1_audio_source_clip_series.html">AudioSourceClipSeries</a>;</div>
<div class="line">    <span class="keyword">auto</span> trackSrc = <span class="keyword">new</span> <a class="code hl_class" href="classtalcs_1_1_positionable_mixer_audio_source.html">PositionableMixerAudioSource</a>;</div>
<div class="line">    trackSrc-&gt;addSource(clipSeries, <span class="keyword">true</span>);</div>
<div class="line">    trackSrcList.append(trackSrc);</div>
<div class="line">    trackSrc-&gt;setGain(trackSpec.toObject().value(<span class="stringliteral">&quot;gain&quot;</span>).toDouble(1.0));</div>
<div class="line">    trackSrc-&gt;setPan(trackSpec.toObject().value(<span class="stringliteral">&quot;pan&quot;</span>).toDouble(0.0));</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span> &amp;clipSpec: trackSpec.toObject().value(<span class="stringliteral">&quot;clips&quot;</span>).toArray()) {</div>
<div class="line">        <span class="keyword">auto</span> audioIndex = clipSpec.toObject().value(<span class="stringliteral">&quot;audio&quot;</span>).toInt();</div>
<div class="line">        <span class="keyword">auto</span> positionSec = clipSpec.toObject().value(<span class="stringliteral">&quot;pos&quot;</span>).toDouble();</div>
<div class="line">        <span class="keyword">auto</span> startPosSec = clipSpec.toObject().value(<span class="stringliteral">&quot;start&quot;</span>).toDouble();</div>
<div class="line">        <span class="keyword">auto</span> lengthSec = clipSpec.toObject().value(<span class="stringliteral">&quot;length&quot;</span>).toDouble();</div>
<div class="line">        qint64 position = positionSec * device-&gt;sampleRate();</div>
<div class="line">        qint64 startPos = startPosSec * device-&gt;sampleRate();</div>
<div class="line">        qint64 length = lengthSec * device-&gt;sampleRate();</div>
<div class="line">        <span class="keyword">auto</span> src = <span class="keyword">new</span> <a class="code hl_class" href="classtalcs_1_1_audio_format_input_source.html">AudioFormatInputSource</a>(srcIoList[audioIndex]);</div>
<div class="line">        srcList.append(src);</div>
<div class="line">        <span class="keywordflow">if</span>(!clipSeries-&gt;addClip({position, src, startPos, length})) {</div>
<div class="line">            QMessageBox::critical(&amp;mainWindow, <span class="stringliteral">&quot;Mixer&quot;</span>, <span class="stringliteral">&quot;Cannot add clip.&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    effectiveLength = std::max(effectiveLength, clipSeries-&gt;effectiveLength());</div>
<div class="line">    mixer.addSource(trackSrc);</div>
<div class="line">}</div>
<div class="ttc" id="aclasstalcs_1_1_audio_format_i_o_html"><div class="ttname"><a href="classtalcs_1_1_audio_format_i_o.html">talcs::AudioFormatIO</a></div><div class="ttdoc">The AudioFormatIO class provides interfaces to access audio files based on libsndfile.</div><div class="ttdef"><b>Definition</b> AudioFormatIO.h:16</div></div>
<div class="ttc" id="aclasstalcs_1_1_audio_format_input_source_html"><div class="ttname"><a href="classtalcs_1_1_audio_format_input_source.html">talcs::AudioFormatInputSource</a></div><div class="ttdoc">Takes audio from an AudioFormatIO object, resamples it to a specified sample rate,...</div><div class="ttdef"><b>Definition</b> AudioFormatInputSource.h:12</div></div>
</div><!-- fragment --><p>Finally, play the audio to the device:</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtalcs_1_1_audio_device.html">AudioDevice</a> *device;</div>
<div class="line"><span class="comment">/* create and initialize the device */</span></div>
<div class="line"><a class="code hl_class" href="classtalcs_1_1_transport_audio_source.html">TransportAudioSource</a> tpSrc;</div>
<div class="line">tpSrc.setSource(&amp;mixer);</div>
<div class="line"><a class="code hl_class" href="classtalcs_1_1_audio_source_playback.html">AudioSourcePlayback</a> playback(&amp;tpSrc);</div>
<div class="line">tpSrc.play();</div>
<div class="line">device-&gt;<a class="code hl_function" href="classtalcs_1_1_audio_device.html#a0b36a991ca9d2abee975e84bb4def2ae">start</a>(&amp;playback);</div>
<div class="ttc" id="aclasstalcs_1_1_audio_device_html"><div class="ttname"><a href="classtalcs_1_1_audio_device.html">talcs::AudioDevice</a></div><div class="ttdoc">Base class for audio devices.</div><div class="ttdef"><b>Definition</b> AudioDevice.h:18</div></div>
<div class="ttc" id="aclasstalcs_1_1_audio_device_html_a0b36a991ca9d2abee975e84bb4def2ae"><div class="ttname"><a href="classtalcs_1_1_audio_device.html#a0b36a991ca9d2abee975e84bb4def2ae">talcs::AudioDevice::start</a></div><div class="ttdeci">virtual bool start(AudioDeviceCallback *audioDeviceCallback)</div><div class="ttdef"><b>Definition</b> AudioDevice.cpp:159</div></div>
<div class="ttc" id="aclasstalcs_1_1_audio_source_playback_html"><div class="ttname"><a href="classtalcs_1_1_audio_source_playback.html">talcs::AudioSourcePlayback</a></div><div class="ttdoc">Callback functions that starts, stops and reads data from an AudioSource.</div><div class="ttdef"><b>Definition</b> AudioSourcePlayback.h:13</div></div>
<div class="ttc" id="aclasstalcs_1_1_transport_audio_source_html"><div class="ttname"><a href="classtalcs_1_1_transport_audio_source.html">talcs::TransportAudioSource</a></div><div class="ttdoc">The object takes a PositionableAudioSource object and supports playing and pausing.</div><div class="ttdef"><b>Definition</b> TransportAudioSource.h:14</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
